#!/bin/sh

DOMAIN="ADDOMAIN"
DOMAIN_USER="administrator"
DOMAIN_PASSWORD="not needed"
BATCHFILE='\\nagiosserver\nagios\install.bat'
TMPFILE=`mktemp`
LOGFILE=/var/log/install_nsclient.log


read -s -p "Password for $DOMAIN/$DOMAIN_USER: " DOMAIN_PASSWORD
echo

for i in $@ ; do
	echo -n "Starting install of $i ... " | tee $LOGFILE
	winexe  -U $DOMAIN/$DOMAIN_USER%"$DOMAIN_PASSWORD" //$i "cmd /c $BATCHFILE" > $TMPFILE
	RESULT=$?
	
	if [ $RESULT -gt 0 ]; then
		echo install of $i failed | tee $LOGFILE
		cat $TMPFILE | tee $LOGFILE
	else
		echo "Install of $i sucessful" | tee $LOGFILE
	fi
done
exit 0

